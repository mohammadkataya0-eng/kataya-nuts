<style>
  :root {
    --sidebar-width: 280px;
  }
  body {
    padding-left: 0;
  }
  @media (max-width: 768px) {
    body {
      padding-left: 0;
    }
  }
</style>

<div id="sidebarTrigger" class="hidden md:flex fixed top-3 left-3 z-50 w-11 h-11 rounded-full bg-[#b51916] text-white items-center justify-center shadow-lg cursor-pointer">
  <span class="text-xl font-bold">â‰¡</span>
</div>

<aside id="sidebar" class="fixed top-0 left-0 h-full w-[var(--sidebar-width)] bg-[#b51916] text-white shadow-2xl z-40 hidden md:flex flex-col transform -translate-x-full transition-transform duration-300 ease-in-out">
  <div class="px-5 py-7 flex items-center gap-4 border-b border-white/10">
    <img src="/images/logo.png" alt="Kataya Nuts Logo" class="w-14 h-14 object-contain drop-shadow" />
    <div class="text-base">
      <div class="font-semibold uppercase tracking-wide text-lg">Kataya Nuts</div>
      <div id="navRole" class="text-white/70 text-xs"></div>
    </div>
  </div>
  <nav class="flex-1 px-4 py-5 space-y-3 text-base">
    <a href="/" class="block px-4 py-3 rounded-lg hover:bg-white/10 transition">Home</a>
    <a id="bagLink" href="/bag" class="block px-4 py-3 rounded-lg hover:bg-white/10 transition">Your Bag</a>
    <a id="checkoutLink" href="/checkout" class="block px-4 py-3 rounded-lg hover:bg-white/10 transition">Checkout</a>
    <a id="profileLink" href="/profile" class="block px-4 py-3 rounded-lg hover:bg-white/10 transition hidden">Profile</a>
    <a id="signinLink" href="/signin" class="block px-4 py-3 rounded-lg hover:bg-white/10 transition">Sign In</a>
    <a id="signupLink" href="/signup" class="block px-4 py-3 rounded-lg hover:bg-white/10 transition">Sign Up</a>
  </nav>
</aside>

<!-- Mobile top bar -->
<header class="md:hidden sticky top-0 z-40 bg-[#b51916] text-white">
  <div class="flex items-center justify-between px-4 py-3">
    <div class="flex items-center gap-2">
      <img src="/images/logo.png" alt="Kataya Nuts Logo" class="w-10 h-10 object-contain" />
      <span class="font-semibold uppercase text-sm">Kataya Nuts</span>
    </div>
    <button aria-label="Toggle menu" onclick="document.getElementById('mobileMenu').classList.toggle('hidden')" class="text-2xl">
      &#9776;
    </button>
  </div>
  <div id="mobileMenu" class="hidden border-t border-white/10">
    <nav class="flex flex-col text-sm">
      <a href="/" class="px-4 py-2 hover:bg-white/10 transition">Home</a>
      <a id="mobileBag" href="/bag" class="px-4 py-2 hover:bg-white/10 transition">Your Bag</a>
      <a id="mobileCheckout" href="/checkout" class="px-4 py-2 hover:bg-white/10 transition">Checkout</a>
      <a id="mobileProfile" href="/profile" class="px-4 py-2 hover:bg-white/10 transition hidden">Profile</a>
      <a id="mobileSignin" href="/signin" class="px-4 py-2 hover:bg-white/10 transition">Sign In</a>
      <a id="mobileSignup" href="/signup" class="px-4 py-2 hover:bg-white/10 transition">Sign Up</a>
    </nav>
  </div>
</header>

<script>
  (function initNav() {
    const token = localStorage.getItem('userToken');
    const isAuthed = Boolean(token);

    // Protect bag/checkout links when not signed in
    const gated = '/signin';
    ['bagLink', 'checkoutLink', 'mobileBag', 'mobileCheckout'].forEach((id) => {
      const el = document.getElementById(id);
      if (el && !isAuthed) el.href = gated;
    });

    // Toggle profile / auth links
    const profileLinks = [document.getElementById('profileLink'), document.getElementById('mobileProfile')];
    profileLinks.forEach((el) => el && el.classList.toggle('hidden', !isAuthed));
    const authShow = !isAuthed;
    ['signinLink', 'signupLink', 'mobileSignin', 'mobileSignup'].forEach((id) => {
      const el = document.getElementById(id);
      if (el) el.classList.toggle('hidden', !authShow ? true : false);
    });
    const roleEl = document.getElementById('navRole');
    if (roleEl && isAuthed) {
      roleEl.textContent = 'Signed in';
    } else if (roleEl) {
      roleEl.textContent = '';
    }
  })();
</script>

<script>
  // Sidebar hover/trigger behavior
  (function sidebarHover() {
    const sidebar = document.getElementById('sidebar');
    const trigger = document.getElementById('sidebarTrigger');
    if (!sidebar || !trigger) return;
    let hideTimeout;

    function open() {
      clearTimeout(hideTimeout);
      sidebar.classList.remove('-translate-x-full');
    }
    function scheduleHide() {
      hideTimeout = setTimeout(() => {
        sidebar.classList.add('-translate-x-full');
      }, 300);
    }

    function hideTrigger() {
      trigger.style.display = 'none';
    }
    function showTrigger() {
      trigger.style.display = 'flex';
    }

    trigger.addEventListener('mouseenter', () => {
      hideTrigger();
      open();
    });
    trigger.addEventListener('mouseleave', () => {
      // in case user leaves quickly without entering sidebar
      scheduleHide();
    });
    sidebar.addEventListener('mouseenter', open);
    sidebar.addEventListener('mouseleave', () => {
      scheduleHide();
      hideTimeout = setTimeout(() => {
        showTrigger();
      }, 350);
    });

    // Ensure trigger reappears if sidebar is hidden for any reason
    sidebar.addEventListener('transitionend', () => {
      if (sidebar.classList.contains('-translate-x-full')) {
        showTrigger();
      }
    });
  })();
</script>
